<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מחשבון גימטריה והמחמאות</title>
  <style>/* העיצוב נשאר אותו דבר */</style>
</head>
<body>
  <h1>מחשבון גימטריה והמחמאות</h1>
  <input type="text" id="nameInput" placeholder="הכנס שם בעברית" />
  <input type="file" id="fileInput" accept=".txt" />
  <button onclick="startCalculation()">חשב גימטריה</button>
  <div id="output"></div>
  <script>
    const gematriaMap = {/* מפה כמו קודם */};

    function calcGematria(str) {/* כמו קודם */}

    function startCalculation() {
      const name = document.getElementById('nameInput').value;
      const file = document.getElementById('fileInput').files[0];
      if (!name || !file) return alert('אנא הכנס שם ובחר קובץ');

      const worker = new Worker(URL.createObjectURL(new Blob([`(${workerCode.toString()})()`], { type: 'application/javascript' })));
      worker.onmessage = function(e) {
        const data = e.data;
        if (data.status === 'progress') {
          document.getElementById('output').innerHTML += `<p>${data.result}</p>`;
        } else if (data.status === 'done') {
          document.getElementById('output').innerHTML += '<p style="color: green;">חישוב הסתיים!</p>';
        }
      };

      const reader = new FileReader();
      reader.onload = () => worker.postMessage({ name, fileContent: reader.result });
      reader.readAsText(file);
    }

    function workerCode() {
      self.onmessage = function(e) {
        const { name, fileContent } = e.data;
        const targetGematria = /* חישוב הגימטריה של השם */;
        const lines = fileContent.split(/\r?\n/);
        let found = false;

        for (let i = 0; i < lines.length; i++) {
          let current = '';
          let currentSum = 0;
          for (let j = i; j < lines.length; j++) {
            const line = lines[j];
            current += (current ? ' ו' : '') + line;
            currentSum += /* חישוב הגימטריה של שורה נוכחית + ו */;

            if (currentSum === targetGematria) {
              self.postMessage({ status: 'progress', result: current });
              found = true;
            }
          }
        }
        self.postMessage({ status: 'done' });
      }
    }
  </script>
</body>
</html>
